<!-- T·∫°o ƒë·ªÅ thi m·ªõi -->
<div class="create-exam-page">
    <div class="page-header">
        <h2>EIU TestLab - T·∫°o b√†i thi m·ªõi</h2>
        <p>T·∫°o b√†i thi tr·∫Øc nghi·ªám v√† t·ª± lu·∫≠n cho sinh vi√™n EIU</p>
    </div>

    <!-- Form t·∫°o ƒë·ªÅ thi -->
    <div class="exam-form-container">
        <form id="createExamForm" class="exam-form">
            <!-- Th√¥ng tin c∆° b·∫£n -->
            <div class="form-section">
                <h3>Th√¥ng tin c∆° b·∫£n</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="examTitle">Ti√™u ƒë·ªÅ b√†i thi *</label>
                        <input type="text" id="examTitle" name="title" required placeholder="Nh·∫≠p ti√™u ƒë·ªÅ b√†i thi">
                    </div>
                    <div class="form-group">
                        <label for="examSubject">M√¥n h·ªçc *</label>
                        <select id="examSubject" name="subject" required>
                            <option value="">Ch·ªçn m√¥n h·ªçc</option>
                            <option value="L·∫≠p tr√¨nh Web">L·∫≠p tr√¨nh Web</option>
                            <option value="C∆° s·ªü d·ªØ li·ªáu">C∆° s·ªü d·ªØ li·ªáu</option>
                            <option value="M·∫°ng m√°y t√≠nh">M·∫°ng m√°y t√≠nh</option>
                            <option value="K·ªπ thu·∫≠t ph·∫ßn m·ªÅm">K·ªπ thu·∫≠t ph·∫ßn m·ªÅm</option>
                            <option value="H·ªá ƒëi·ªÅu h√†nh">H·ªá ƒëi·ªÅu h√†nh</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="examDuration">Th·ªùi gian l√†m b√†i (ph√∫t) *</label>
                        <input type="number" id="examDuration" name="duration" required min="5" max="300" value="60">
                    </div>
                    <div class="form-group">
                        <label for="examMaxAttempts">S·ªë l·∫ßn l√†m t·ªëi ƒëa</label>
                        <input type="number" id="examMaxAttempts" name="maxAttempts" min="1" max="10" value="1">
                    </div>
                </div>

                <div class="form-group">
                    <label for="examDescription">M√¥ t·∫£ b√†i thi</label>
                    <textarea id="examDescription" name="description" rows="3"
                        placeholder="M√¥ t·∫£ ng·∫Øn v·ªÅ n·ªôi dung b√†i thi"></textarea>
                </div>
            </div>

            <!-- C√†i ƒë·∫∑t n√¢ng cao -->
            <div class="form-section">
                <h3>C√†i ƒë·∫∑t n√¢ng cao</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="shuffleQuestions" name="shuffleQuestions" checked>
                            <span class="checkmark"></span>
                            Tr·ªôn th·ª© t·ª± c√¢u h·ªèi
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="shuffleAnswers" name="shuffleAnswers" checked>
                            <span class="checkmark"></span>
                            Tr·ªôn th·ª© t·ª± ƒë√°p √°n
                        </label>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="showResults" name="showResults" checked>
                            <span class="checkmark"></span>
                            Hi·ªÉn th·ªã k·∫øt qu·∫£ ngay sau khi n·ªôp b√†i
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="allowReview" name="allowReview" checked>
                            <span class="checkmark"></span>
                            Cho ph√©p xem l·∫°i b√†i l√†m
                        </label>
                    </div>
                </div>
            </div>

            <!-- C√¢u h·ªèi -->
            <div class="form-section">
                <div class="section-header">
                    <h3>C√¢u h·ªèi</h3>
                    <div class="section-actions">
                        <button type="button" id="addQuestionBtn" class="btn btn-secondary" onclick="window.createExam?.addQuestion()">
                            <span class="btn-icon">‚ûï</span>
                            Th√™m c√¢u h·ªèi
                        </button>
                        <button type="button" id="importMarkdownBtn" class="btn btn-outline">
                            <span class="btn-icon">üìù</span>
                            Import t·ª´ Markdown
                        </button>
                        <button type="button" id="importQuestionsBtn" class="btn btn-outline">
                            <span class="btn-icon">üìÅ</span>
                            Import t·ª´ file
                        </button>
                    </div>
                </div>

                <div id="questionsContainer" class="questions-container">
                    <!-- Questions will be added here dynamically -->
                </div>

                <div class="empty-questions" id="emptyQuestions">
                    <div class="empty-icon">‚ùì</div>
                    <h4>Ch∆∞a c√≥ c√¢u h·ªèi n√†o</h4>
                    <p>B·∫Øt ƒë·∫ßu t·∫°o c√¢u h·ªèi cho b√†i thi c·ªßa b·∫°n</p>
                    <button type="button" onclick="window.createExam?.addQuestion()" class="btn btn-primary">
                        Th√™m c√¢u h·ªèi ƒë·∫ßu ti√™n
                    </button>
                </div>
            </div>

            <!-- Action buttons -->
            <div class="form-actions">
                <button type="button" onclick="window.app.loadPage('dashboard')" class="btn btn-secondary">
                    H·ªßy
                </button>
                <button type="button" id="saveAsDraftBtn" class="btn btn-outline">
                    <span class="btn-icon">üíæ</span>
                    L∆∞u nh√°p
                </button>
                <button type="submit" class="btn btn-primary">
                    <span class="btn-icon">‚úÖ</span>
                    T·∫°o b√†i thi
                </button>
            </div>
        </form>
    </div>

    <!-- Question template (hidden) -->
    <template id="questionTemplate">
        <div class="question-item" data-question-id="">
            <div class="question-header">
                <div class="question-number">C√¢u <span class="number">1</span></div>
                <div class="question-type">
                    <select class="question-type-select">
                        <option value="multiple-choice">Tr·∫Øc nghi·ªám (1 ƒë√°p √°n)</option>
                        <option value="multiple-select">Tr·∫Øc nghi·ªám (nhi·ªÅu ƒë√°p √°n)</option>
                        <option value="text">T·ª± lu·∫≠n ng·∫Øn</option>
                    </select>
                </div>
                <div class="question-actions">
                    <button type="button" class="btn-icon" onclick="window.createExam?.moveQuestionUp(this)"
                        title="Di chuy·ªÉn l√™n">‚¨ÜÔ∏è</button>
                    <button type="button" class="btn-icon" onclick="window.createExam?.moveQuestionDown(this)"
                        title="Di chuy·ªÉn xu·ªëng">‚¨áÔ∏è</button>
                    <button type="button" class="btn-icon" onclick="window.createExam?.duplicateQuestion(this)"
                        title="Nh√¢n ƒë√¥i">üìã</button>
                    <button type="button" class="btn-icon" onclick="window.createExam?.deleteQuestion(this)"
                        title="X√≥a">üóëÔ∏è</button>
                </div>
            </div>

            <div class="question-content">
                <div class="form-group">
                    <label>N·ªôi dung c√¢u h·ªèi *</label>
                    <textarea class="question-text" rows="3" required placeholder="Nh·∫≠p n·ªôi dung c√¢u h·ªèi"></textarea>
                </div>

                <!-- Multiple choice options -->
                <div class="answer-options multiple-choice-options">
                    <label>C√°c ƒë√°p √°n (ch·ªçn ƒë√°p √°n ƒë√∫ng)</label>
                    <div class="options-container">
                        <!-- Options will be added here -->
                    </div>
                    <button type="button" class="add-option-btn" onclick="window.createExam?.addOption(this)">
                        ‚ûï Th√™m ƒë√°p √°n
                    </button>
                </div>

                <!-- Text answer -->
                <div class="answer-options text-options" style="display: none;">
                    <div class="form-group">
                        <label>ƒê√°p √°n ƒë√∫ng *</label>
                        <input type="text" class="correct-text-answer"
                            placeholder="Nh·∫≠p ƒë√°p √°n ƒë√∫ng (kh√¥ng ph√¢n bi·ªát hoa th∆∞·ªùng)">
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" class="case-sensitive">
                            <span class="checkmark"></span>
                            Ph√¢n bi·ªát hoa th∆∞·ªùng
                        </label>
                    </div>
                </div>

                <!-- Question settings -->
                <div class="question-settings">
                    <div class="form-row">
                        <div class="form-group">
                            <label>ƒêi·ªÉm s·ªë</label>
                            <input type="number" class="question-points" min="0.5" max="10" step="0.5" value="1">
                        </div>
                        <div class="form-group">
                            <label>Gi·∫£i th√≠ch (t√πy ch·ªçn)</label>
                            <textarea class="question-explanation" rows="2"
                                placeholder="Gi·∫£i th√≠ch ƒë√°p √°n ƒë√∫ng"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Option template (hidden) -->
    <template id="optionTemplate">
        <div class="option-item">
            <div class="option-input">
                <input type="radio" name="correct-answer" class="correct-indicator">
                <input type="text" class="option-text" placeholder="Nh·∫≠p ƒë√°p √°n" required>
                <button type="button" class="remove-option-btn" onclick="createExam.removeOption(this)">
                    ‚ùå
                </button>
            </div>
        </div>
    </template>

    <!-- Import Markdown Modal -->
    <div id="importMarkdownModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìù Import ƒë·ªÅ thi t·ª´ Markdown</h3>
                <button class="modal-close" onclick="createExam.closeMarkdownModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="import-section">
                    <h4>Ch·ªçn file Markdown (.md)</h4>
                    <p class="help-text">
                        <a href="markdown_guide.md" target="_blank">üìñ Xem h∆∞·ªõng d·∫´n t·∫°o ƒë·ªÅ thi Markdown</a> |
                        <a href="sample_exam.md" target="_blank">üìÑ T·∫£i file m·∫´u</a>
                    </p>
                    <div class="file-upload-area">
                        <input type="file" id="markdownFile" accept=".md" style="display: none;">
                        <div class="file-upload-zone" onclick="document.getElementById('markdownFile').click()">
                            <div class="upload-icon">üìÅ</div>
                            <p>Click ƒë·ªÉ ch·ªçn file .md ho·∫∑c k√©o th·∫£ file v√†o ƒë√¢y</p>
                            <small>H·ªó tr·ª£ ƒë·ªãnh d·∫°ng Markdown v·ªõi c√∫ ph√°p ƒë·∫∑c bi·ªát cho ƒë·ªÅ thi</small>
                        </div>
                    </div>
                </div>

                <div class="import-section">
                    <h4>Ho·∫∑c d√°n n·ªôi dung Markdown</h4>
                    <textarea id="markdownContent" rows="10" placeholder="D√°n n·ªôi dung Markdown v√†o ƒë√¢y..."></textarea>
                </div>

                <div class="import-section">
                    <h4>Xem tr∆∞·ªõc</h4>
                    <div id="markdownPreview" class="markdown-preview">
                        <p class="preview-placeholder">N·ªôi dung s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y sau khi ch·ªçn file ho·∫∑c d√°n n·ªôi
                            dung</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="createExam.closeMarkdownModal()">
                    H·ªßy
                </button>
                <button type="button" class="btn btn-primary" onclick="createExam.importFromMarkdown()">
                    <span class="btn-icon">‚¨áÔ∏è</span>
                    Import c√¢u h·ªèi
                </button>
            </div>
        </div>
    </div>

    <!-- Progress indicator -->
    <div id="saveProgress" class="save-progress" style="display: none;">
        <div class="progress-content">
            <div class="spinner"></div>
            <span>ƒêang l∆∞u...</span>
        </div>
    </div>
</div>

<!-- Debug script to check CreateExam initialization -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded - checking CreateExam...');
    
    setTimeout(() => {
        if (window.createExam) {
            console.log('‚úÖ CreateExam is available:', window.createExam);
            
            // Test form submission
            const form = document.getElementById('createExamForm');
            if (form) {
                console.log('‚úÖ Form found');
                
                // Add debug listener
                form.addEventListener('submit', function(e) {
                    console.log('üî• Form submit event triggered!');
                    if (!window.createExam) {
                        console.error('‚ùå CreateExam not available on submit');
                        e.preventDefault();
                        alert('L·ªói: CreateExam ch∆∞a ƒë∆∞·ª£c kh·ªüi t·∫°o');
                    }
                });
            } else {
                console.error('‚ùå Form not found');
            }
        } else {
            console.error('‚ùå CreateExam not available');
            
            // Try to initialize manually
            if (window.CreateExam) {
                console.log('Trying to initialize CreateExam manually...');
                window.createExam = new CreateExam();
            }
        }
    }, 500);
});
</script>