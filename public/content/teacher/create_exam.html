<!-- Tạo đề thi mới -->
<div class="create-exam-page">
    <div class="page-header bg-gradient-primary">
        <div class="container">
            <div class="header-content">
                <div class="header-text">
                    <h2 class="header-title">
                        <i class="fas fa-plus-circle"></i>
                        Tạo bài thi mới
                    </h2>
                    <p class="header-subtitle">Tạo bài thi trắc nghiệm cho sinh viên với giao diện thân thiện</p>
                </div>
                <div class="header-actions">
                    <button type="button" class="btn btn-light btn-sm" onclick="window.app.loadPage('dashboard')">
                        <i class="fas fa-arrow-left"></i>
                        Quay lại
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Form tạo đề thi -->
    <div class="container mt-4">
        <div class="exam-form-container">
            <form id="createExamForm" class="exam-form card shadow-lg">
                <!-- Thông tin cơ bản -->
                <div class="form-section card-body border-start border-primary border-4">
                    <div class="section-header">
                        <h3 class="section-title">
                            <i class="fas fa-info-circle text-primary"></i>
                            Thông tin cơ bản
                        </h3>
                        <p class="section-subtitle text-muted">Cung cấp thông tin chung về bài thi</p>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="examTitle" class="form-label fw-semibold">
                                    <i class="fas fa-pencil-alt text-primary me-2"></i>
                                    Tiêu đề bài thi <span class="text-danger">*</span>
                                </label>
                                <input type="text" id="examTitle" name="title" required 
                                       class="form-control form-control-lg"
                                       placeholder="Nhập tiêu đề bài thi">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="examSubject" class="form-label fw-semibold">
                                    <i class="fas fa-book text-primary me-2"></i>
                                    Môn học <span class="text-danger">*</span>
                                </label>
                                <select id="examSubject" name="subject" required class="form-select form-select-lg">
                                    <option value="">Chọn môn học</option>
                                    <option value="Lập trình Web">Lập trình Web</option>
                                    <option value="Cơ sở dữ liệu">Cơ sở dữ liệu</option>
                                    <option value="Mạng máy tính">Mạng máy tính</option>
                                    <option value="Kỹ thuật phần mềm">Kỹ thuật phần mềm</option>
                                    <option value="Hệ điều hành">Hệ điều hành</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="examDuration" class="form-label fw-semibold">
                                    <i class="fas fa-clock text-primary me-2"></i>
                                    Thời gian làm bài (phút) <span class="text-danger">*</span>
                                </label>
                                <input type="number" id="examDuration" name="duration" required 
                                       class="form-control form-control-lg"
                                       min="5" max="300" value="60">
                                <div class="form-text">Từ 5 đến 300 phút</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="examMaxAttempts" class="form-label fw-semibold">
                                    <i class="fas fa-redo text-primary me-2"></i>
                                    Số lần làm tối đa
                                </label>
                                <input type="number" id="examMaxAttempts" name="maxAttempts" 
                                       class="form-control form-control-lg"
                                       min="1" max="10" value="1">
                                <div class="form-text">Từ 1 đến 10 lần</div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <label for="examDescription" class="form-label fw-semibold">
                            <i class="fas fa-align-left text-primary me-2"></i>
                            Mô tả bài thi
                        </label>
                        <textarea id="examDescription" name="description" rows="3" 
                                  class="form-control"
                                  placeholder="Mô tả ngắn về nội dung bài thi"></textarea>
                    </div>
                </div>

                <!-- Cài đặt nâng cao -->
                <div class="form-section card-body border-start border-success border-4 mt-4">
                    <div class="section-header">
                        <h3 class="section-title">
                            <i class="fas fa-cogs text-success"></i>
                            Cài đặt nâng cao
                        </h3>
                        <p class="section-subtitle text-muted">Tùy chỉnh các tính năng bổ sung cho bài thi</p>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check form-switch mb-3">
                                <input type="checkbox" id="shuffleQuestions" name="shuffleQuestions" 
                                       class="form-check-input" checked>
                                <label class="form-check-label fw-semibold" for="shuffleQuestions">
                                    <i class="fas fa-random text-success me-2"></i>
                                    Trộn thứ tự câu hỏi
                                </label>
                                <div class="form-text">Hiển thị câu hỏi theo thứ tự ngẫu nhiên</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check form-switch mb-3">
                                <input type="checkbox" id="shuffleAnswers" name="shuffleAnswers" 
                                       class="form-check-input" checked>
                                <label class="form-check-label fw-semibold" for="shuffleAnswers">
                                    <i class="fas fa-shuffle text-success me-2"></i>
                                    Trộn thứ tự đáp án
                                </label>
                                <div class="form-text">Hiển thị đáp án theo thứ tự ngẫu nhiên</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check form-switch mb-3">
                                <input type="checkbox" id="showResults" name="showResults" 
                                       class="form-check-input" checked>
                                <label class="form-check-label fw-semibold" for="showResults">
                                    <i class="fas fa-chart-bar text-success me-2"></i>
                                    Hiển thị kết quả ngay sau khi nộp bài
                                </label>
                                <div class="form-text">Sinh viên xem điểm số ngay lập tức</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check form-switch mb-3">
                                <input type="checkbox" id="allowReview" name="allowReview" 
                                       class="form-check-input" checked>
                                <label class="form-check-label fw-semibold" for="allowReview">
                                    <i class="fas fa-eye text-success me-2"></i>
                                    Cho phép xem lại bài làm
                                </label>
                                <div class="form-text">Sinh viên có thể xem lại đáp án đã chọn</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Câu hỏi -->
                <div class="form-section card-body border-start border-warning border-4 mt-4">
                    <div class="section-header d-flex justify-content-between align-items-center">
                        <div>
                            <h3 class="section-title">
                                <i class="fas fa-question-circle text-warning"></i>
                                Câu hỏi
                            </h3>
                            <p class="section-subtitle text-muted">Thêm các câu hỏi cho bài thi của bạn</p>
                        </div>
                        <div class="section-actions">
                            <button type="button" id="addQuestionBtn" class="btn btn-warning btn-lg me-2">
                                <i class="fas fa-plus"></i>
                                Thêm câu hỏi
                            </button>
                            <button type="button" id="importQuestionsBtn" class="btn btn-outline-warning btn-lg">
                                <i class="fas fa-file-import"></i>
                                Import từ file
                            </button>
                        </div>
                    </div>

                    <div id="questionsContainer" class="questions-container mt-4">
                        <!-- Questions will be added here dynamically -->
                    </div>

                    <div class="empty-questions text-center py-5" id="emptyQuestions">
                        <div class="empty-icon mb-3">
                            <i class="fas fa-question-circle fa-4x text-muted"></i>
                        </div>
                        <h4 class="text-muted">Chưa có câu hỏi nào</h4>
                        <p class="text-muted mb-4">Bắt đầu tạo câu hỏi cho bài thi của bạn</p>
                        <button type="button" onclick="window.createExam?.addQuestion()" 
                                class="btn btn-warning btn-lg">
                            <i class="fas fa-plus"></i>
                            Thêm câu hỏi đầu tiên
                        </button>
                    </div>
                </div>

                <!-- Action buttons -->
                <div class="form-actions card-footer bg-light d-flex justify-content-end gap-3 mt-4">
                    <button type="button" onclick="window.app.loadPage('dashboard')" 
                            class="btn btn-light btn-lg">
                        <i class="fas fa-times"></i>
                        Hủy
                    </button>
                    <button type="button" id="saveAsDraftBtn" class="btn btn-outline-primary btn-lg">
                        <i class="fas fa-save"></i>
                        Lưu nháp
                    </button>
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-check"></i>
                        Tạo bài thi
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Question template (hidden) -->
    <template id="questionTemplate">
        <div class="question-item" data-question-id="">
            <div class="question-header d-flex justify-content-between align-items-center flex-wrap gap-3">
                <div class="question-number">
                    <h5 class="mb-0">
                        <i class="fas fa-question-circle text-info me-2"></i>
                        Câu <span class="number">1</span>
                    </h5>
                </div>
                <div class="question-type">
                    <select class="question-type-select form-select" aria-label="Loại câu hỏi">
                        <option value="multiple-choice">Trắc nghiệm (1 đáp án)</option>
                        <option value="multiple-select">Trắc nghiệm (nhiều đáp án)</option>
                        <option value="text">Tự luận ngắn</option>
                    </select>
                </div>
                <div class="question-actions">
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-outline-secondary" 
                                onclick="window.createExam?.moveQuestionUp(this)" title="Di chuyển lên">
                            <i class="fas fa-arrow-up"></i>
                            <span class="d-none d-md-inline ms-1">Lên</span>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-secondary" 
                                onclick="window.createExam?.moveQuestionDown(this)" title="Di chuyển xuống">
                            <i class="fas fa-arrow-down"></i>
                            <span class="d-none d-md-inline ms-1">Xuống</span>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-info" 
                                onclick="window.createExam?.duplicateQuestion(this)" title="Nhân đôi">
                            <i class="fas fa-copy"></i>
                            <span class="d-none d-md-inline ms-1">Sao chép</span>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-danger" 
                                onclick="window.createExam?.deleteQuestion(this)" title="Xóa">
                            <i class="fas fa-trash"></i>
                            <span class="d-none d-md-inline ms-1">Xóa</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="question-content">
                <div class="form-group mb-3">
                    <label for="questionText" class="form-label fw-semibold">
                        <i class="fas fa-edit text-info me-2"></i>
                        Nội dung câu hỏi <span class="text-danger">*</span>
                    </label>
                    <textarea id="questionText" class="question-text form-control" rows="3" required 
                              placeholder="Nhập nội dung câu hỏi"></textarea>
                </div>

                <!-- Multiple choice options -->
                <div class="answer-options multiple-choice-options">
                    <div class="form-label fw-semibold">
                        <i class="fas fa-list text-info me-2"></i>
                        Các đáp án (chọn đáp án đúng)
                    </div>
                    <div class="options-container">
                        <!-- Options will be added here -->
                    </div>
                    <button type="button" class="add-option-btn btn btn-outline-info btn-sm mt-2" 
                            onclick="window.createExam?.addOption(this)">
                        <i class="fas fa-plus"></i>
                        Thêm đáp án
                    </button>
                </div>

                <!-- Text answer -->
                <div class="answer-options text-options" style="display: none;">
                    <div class="form-group mb-3">
                        <label for="correctTextAnswer" class="form-label fw-semibold">
                            <i class="fas fa-check text-success me-2"></i>
                            Đáp án đúng <span class="text-danger">*</span>
                        </label>
                        <input type="text" id="correctTextAnswer" class="correct-text-answer form-control" 
                               placeholder="Nhập đáp án đúng (không phân biệt hoa thường)">
                    </div>
                    <div class="form-check">
                        <input type="checkbox" id="caseSensitive" class="case-sensitive form-check-input">
                        <label class="form-check-label" for="caseSensitive">
                            Phân biệt hoa thường
                        </label>
                    </div>
                </div>

                <!-- Question settings -->
                <div class="question-settings">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="questionPoints" class="form-label fw-semibold">
                                    <i class="fas fa-star text-warning me-2"></i>
                                    Điểm số
                                </label>
                                <input type="number" id="questionPoints" class="question-points form-control" 
                                       min="0.5" max="10" step="0.5" value="1">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="questionExplanation" class="form-label fw-semibold">
                                    <i class="fas fa-lightbulb text-warning me-2"></i>
                                    Giải thích (tùy chọn)
                                </label>
                                <textarea id="questionExplanation" class="question-explanation form-control" rows="2" 
                                          placeholder="Giải thích đáp án đúng"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Option template (hidden) -->
    <template id="optionTemplate">
        <div class="option-item card mb-2">
            <div class="card-body p-3">
                <div class="d-flex align-items-center gap-3">
                    <div class="form-check">
                        <input type="radio" name="correct-answer" class="correct-indicator form-check-input">
                    </div>
                    <input type="text" class="option-text form-control" placeholder="Nhập đáp án" required>
                    <button type="button" class="remove-option-btn btn btn-outline-danger btn-sm" 
                            onclick="createExam.removeOption(this)">
                        <i class="fas fa-times"></i>
                        <span class="d-none d-lg-inline ms-1">Xóa</span>
                    </button>
                </div>
            </div>
        </div>
    </template>
</div>

<!-- Progress indicator -->
<div id="saveProgress" class="save-progress position-fixed top-50 start-50 translate-middle" style="display: none;">
    <div class="progress-content card shadow-lg p-4 text-center">
        <div class="spinner-border text-primary mb-3" aria-label="Loading">
            <span class="visually-hidden">Loading...</span>
        </div>
        <span class="fw-semibold">Đang lưu...</span>
    </div>
</div>
