<!-- Trang th·ªëng k√™ ƒëƒÉng nh·∫≠p -->
<div class="login-stats">
    <div class="stats-header">
        <h2>Th·ªëng k√™ ƒëƒÉng nh·∫≠p</h2>
        <p>Theo d√µi ho·∫°t ƒë·ªông ƒëƒÉng nh·∫≠p c·ªßa h·ªá th·ªëng</p>
    </div>

    <!-- Th·ªëng k√™ t·ªïng quan -->
    <div class="stats-overview">
        <div class="stat-card">
            <div class="stat-icon">üë•</div>
            <div class="stat-content">
                <div class="stat-number" id="total-users">0</div>
                <div class="stat-label">T·ªïng ng∆∞·ªùi d√πng</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">üîë</div>
            <div class="stat-content">
                <div class="stat-number" id="total-logins">0</div>
                <div class="stat-label">L∆∞·ª£t ƒëƒÉng nh·∫≠p</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-content">
                <div class="stat-number" id="successful-logins">0</div>
                <div class="stat-label">ƒêƒÉng nh·∫≠p th√†nh c√¥ng</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">‚ùå</div>
            <div class="stat-content">
                <div class="stat-number" id="failed-logins">0</div>
                <div class="stat-label">ƒêƒÉng nh·∫≠p th·∫•t b·∫°i</div>
            </div>
        </div>
    </div>

    <!-- L·ªãch s·ª≠ ƒëƒÉng nh·∫≠p -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">L·ªãch s·ª≠ ƒëƒÉng nh·∫≠p g·∫ßn ƒë√¢y</h3>
            <button onclick="clearLoginHistory()" class="btn btn-secondary btn-sm">X√≥a l·ªãch s·ª≠</button>
        </div>
        <div class="login-history" id="login-history">
            <div class="no-data">
                <p>Ch∆∞a c√≥ l·ªãch s·ª≠ ƒëƒÉng nh·∫≠p</p>
            </div>
        </div>
    </div>

    <!-- Ho·∫°t ƒë·ªông ng∆∞·ªùi d√πng -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Ho·∫°t ƒë·ªông ng∆∞·ªùi d√πng</h3>
            <button onclick="clearUserActivities()" class="btn btn-secondary btn-sm">X√≥a ho·∫°t ƒë·ªông</button>
        </div>
        <div class="user-activities" id="user-activities">
            <div class="no-data">
                <p>Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o</p>
            </div>
        </div>
    </div>
</div>

<style>
    .login-stats {
        animation: fadeInUp 0.5s ease-out;
    }

    .stats-header {
        text-align: center;
        margin-bottom: 30px;
        padding: 30px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
    }

    .stats-header h2 {
        font-size: 2rem;
        margin-bottom: 10px;
    }

    .stats-header p {
        opacity: 0.9;
        font-size: 1.1rem;
    }

    .stats-overview {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        gap: 15px;
        transition: transform 0.3s ease;
        border-top: 4px solid #667eea;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15);
    }

    .stat-icon {
        font-size: 2.5rem;
        opacity: 0.8;
    }

    .stat-content {
        flex: 1;
    }

    .stat-number {
        font-size: 2rem;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 5px;
    }

    .stat-label {
        color: #718096;
        font-weight: 500;
        font-size: 0.9rem;
    }

    .card-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 20px;
    }

    .btn-sm {
        padding: 6px 12px;
        font-size: 12px;
    }

    .login-history,
    .user-activities {
        max-height: 400px;
        overflow-y: auto;
    }

    .history-item,
    .activity-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        border-bottom: 1px solid #e2e8f0;
        transition: background-color 0.2s ease;
    }

    .history-item:hover,
    .activity-item:hover {
        background-color: #f7fafc;
    }

    .history-item:last-child,
    .activity-item:last-child {
        border-bottom: none;
    }

    .item-info h4 {
        margin-bottom: 3px;
        color: #2d3748;
        font-size: 1rem;
    }

    .item-info p {
        color: #718096;
        font-size: 0.85rem;
        margin: 0;
    }

    .item-meta {
        text-align: right;
    }

    .item-status {
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        margin-bottom: 3px;
        display: inline-block;
    }

    .status-success {
        background: #d4edda;
        color: #155724;
    }

    .status-failed {
        background: #f8d7da;
        color: #721c24;
    }

    .status-activity {
        background: #cce5ff;
        color: #004085;
    }

    .item-time {
        color: #a0aec0;
        font-size: 0.75rem;
    }

    .no-data {
        text-align: center;
        padding: 40px;
        color: #718096;
        font-style: italic;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @media (max-width: 768px) {
        .stats-header {
            padding: 20px;
        }

        .stats-header h2 {
            font-size: 1.5rem;
        }

        .stat-card {
            padding: 20px;
        }

        .stat-number {
            font-size: 1.5rem;
        }

        .card-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .history-item,
        .activity-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
        }

        .item-meta {
            text-align: left;
            width: 100%;
        }
    }
</style>

<script>
    // Load d·ªØ li·ªáu th·ªëng k√™ khi trang ƒë∆∞·ª£c t·∫£i
    document.addEventListener('DOMContentLoaded', function () {
        loadLoginStats();
    });

    function loadLoginStats() {
        try {
            // Load login attempts
            const loginAttempts = JSON.parse(localStorage.getItem('loginAttempts') || '[]');
            const userActivities = JSON.parse(localStorage.getItem('userActivities') || '[]');
            const users = JSON.parse(localStorage.getItem('currentUser') || '{}');

            // Calculate statistics
            const totalLogins = loginAttempts.length;
            const successfulLogins = loginAttempts.filter(attempt => attempt.success).length;
            const failedLogins = totalLogins - successfulLogins;
            const totalUsers = Object.keys(users).length || 1; // At least current user

            // Update overview stats
            document.getElementById('total-users').textContent = totalUsers;
            document.getElementById('total-logins').textContent = totalLogins;
            document.getElementById('successful-logins').textContent = successfulLogins;
            document.getElementById('failed-logins').textContent = failedLogins;

            // Display login history
            displayLoginHistory(loginAttempts);

            // Display user activities
            displayUserActivities(userActivities);

        } catch (error) {
            console.error('Error loading login stats:', error);
        }
    }

    function displayLoginHistory(attempts) {
        const container = document.getElementById('login-history');

        if (attempts.length === 0) {
            container.innerHTML = '<div class="no-data"><p>Ch∆∞a c√≥ l·ªãch s·ª≠ ƒëƒÉng nh·∫≠p</p></div>';
            return;
        }

        // Sort by timestamp (newest first)
        attempts.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

        container.innerHTML = attempts.map(attempt => `
        <div class="history-item">
            <div class="item-info">
                <h4>${attempt.username}</h4>
                <p>IP: ${attempt.ip}</p>
            </div>
            <div class="item-meta">
                <div class="item-status ${attempt.success ? 'status-success' : 'status-failed'}">
                    ${attempt.success ? 'Th√†nh c√¥ng' : 'Th·∫•t b·∫°i'}
                </div>
                <div class="item-time">${formatDateTime(attempt.timestamp)}</div>
            </div>
        </div>
    `).join('');
    }

    function displayUserActivities(activities) {
        const container = document.getElementById('user-activities');

        if (activities.length === 0) {
            container.innerHTML = '<div class="no-data"><p>Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o</p></div>';
            return;
        }

        // Sort by timestamp (newest first) and take last 20
        activities.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        const recentActivities = activities.slice(0, 20);

        container.innerHTML = recentActivities.map(activity => `
        <div class="activity-item">
            <div class="item-info">
                <h4>${activity.user}</h4>
                <p>${activity.description}</p>
            </div>
            <div class="item-meta">
                <div class="item-status status-activity">${activity.type}</div>
                <div class="item-time">${formatDateTime(activity.timestamp)}</div>
            </div>
        </div>
    `).join('');
    }

    function clearLoginHistory() {
        if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a l·ªãch s·ª≠ ƒëƒÉng nh·∫≠p?')) {
            localStorage.removeItem('loginAttempts');
            loadLoginStats();
            alert('ƒê√£ x√≥a l·ªãch s·ª≠ ƒëƒÉng nh·∫≠p');
        }
    }

    function clearUserActivities() {
        if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a l·ªãch s·ª≠ ho·∫°t ƒë·ªông?')) {
            localStorage.removeItem('userActivities');
            loadLoginStats();
            alert('ƒê√£ x√≥a l·ªãch s·ª≠ ho·∫°t ƒë·ªông');
        }
    }

    function formatDateTime(dateTimeString) {
        const date = new Date(dateTimeString);
        return date.toLocaleDateString('vi-VN') + ' ' +
            date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
    }
</script>